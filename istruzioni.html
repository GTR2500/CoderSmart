<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tecnical Coder — Istruzioni</title>
  <link rel="stylesheet" href="assets/styles.css" />
  <style>
    main{max-width:1000px;margin:0 auto;padding:20px}
    .card h2{margin:0 0 10px}
    .card h3{margin:16px 0 8px}
    ul,ol{margin:8px 0 8px 18px}
    .callout{background:var(--panel2);border:1px solid var(--line);border-radius:10px;padding:10px;margin:8px 0;color:var(--text)}
    .ok{border-left:4px solid #22c55e}
    .warn{border-left:4px solid #f59e0b}
    .bad{border-left:4px solid #ef4444}
    code{background:var(--panel2);border:1px solid var(--line);padding:0 4px;border-radius:4px}
  </style>
</head>
<body>

  <!-- ===== HEADER ===== -->
  <header class="app-header">
    <a class="brand" href="https://www.glcgrimaldelli.com" target="_blank" rel="noopener">
      <img class="brand-logo" src="https://www.glcgrimaldelli.com/wp-content/uploads/2019/06/Logo-Sottopagine.jpg" alt="Grimaldelli s.r.l." />
    </a>

    <h1 class="brand-title">Tecnical Coder</h1>

    <!-- Badge versione + toggle tema -->
    <div id="buildBadge" class="build-badge" title="Ultimo aggiornamento"></div>
    <button id="themeToggle" class="theme-toggle" title="Cambia tema">
      <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="4"/><path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2m16 0h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"/></svg>
      <svg class="icon-moon" viewBox="0 0 24 24" fill="currentColor"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
    </button>
  </header>

  <!-- ===== NAV ===== -->
  <div class="subnav">
    <div class="bar">
      <nav>
        <a href="index.html">Generatore</a>
        <a class="active" href="istruzioni.html">Istruzioni</a>
        <a href="dati.html">Dati</a>
      </nav>
    </div>
  </div>

  <main>
    <!-- Cos’è -->
    <section class="card">
      <h2>Cos’è Tecnical Coder (spiegato semplice)</h2>
      <p>Tecnical Coder crea automaticamente un <b>codice compatto</b> (ShortCode) e una <b>descrizione</b> per i prodotti.  
      Tu scegli Famiglia, Tipo, misure e altri dati: il programma costruisce per te:</p>
      <ul>
        <li><b>ShortCode (auto)</b>: il codice tecnico (solo sigle e numeri).</li>
        <li><b>Descrizione (auto)</b>: un testo leggibile e compatto.</li>
        <li><b>Nome cartella (auto)</b>: codice + descrizione, pronto da copiare.</li>
      </ul>
      <div class="callout ok">Non serve conoscere l’informatica: basta riempire i campi e premere “Copia”.</div>
    </section>

    <!-- Cosa serve -->
    <section class="card">
      <h2>Di cosa hai bisogno</h2>
      <ul>
        <li>Un browser moderno (Chrome, Edge, Firefox).</li>
        <li>Connessione Internet per caricare i dati dal sito.</li>
        <li><i>Facoltativo</i>: un account GitHub solo se vuoi salvare i dati direttamente nel repository.</li>
      </ul>
      <div class="callout warn">In alto a destra trovi il pulsante <b>sole/luna</b> per passare tra tema <b>chiaro</b> e <b>scuro</b>.</div>
    </section>

    <!-- Aggiornamenti -->
    <section class="card">
      <h2>Aggiornamenti &amp; Versione</h2>
      <p>In alto a destra vedi un badge arancione: <i>“Ultimo agg.: data • sha”</i>.  
        Si aggiorna da solo leggendo l’ultimo commit del sito.</p>
      <ul>
        <li><b>Clicca il badge</b> per forzare l’aggiornamento del tuo client: cancella eventuali dati locali, pulisce la cache e ricarica il sito fresco.</li>
        <li>Comparirà una <b>conferma</b> prima di procedere.</li>
      </ul>
      <div class="callout ok">Non devi gestire file “version.json”: la data e la versione si aggiornano automaticamente dal repository.</div>
    </section>

    <!-- Prima volta: Dati -->
    <section class="card">
      <h2>Prima volta: prepara le liste in <a href="dati.html">Dati</a></h2>
      <p>Le tendine del Generatore prendono i valori da quattro liste (cataloghi):</p>
      <ol>
        <li><b>Famiglie</b> (es. ARG = Argani, CAN = Cancelli…)</li>
        <li><b>Materiali</b> (es. S235, S355, AISI304…)</li>
        <li><b>Finiture</b> (es. GR = Grezzo, V = Verniciato…)</li>
        <li><b>Tipi</b> (es. TUB = Tubo, LAM = Lamiera…)</li>
      </ol>
      <h3>Come aggiungere una voce</h3>
      <ol>
        <li>Apri la pagina <a href="dati.html">Dati</a>.</li>
        <li>Seleziona la scheda (Famiglie, Materiali, Finiture o Tipi).</li>
        <li>Clicca <b>+ Aggiungi…</b>, scrivi <b>Codice</b> (breve, senza spazi) e <b>Descrizione</b> (nome completo).</li>
        <li>Per le <b>Famiglie</b> spunta anche le caselle:
          <ul>
            <li><b>D</b> — se la famiglia usa il diametro Ø.</li>
            <li><b>L</b> — se usa la lunghezza L.</li>
            <li><b>H</b> — se usa l’altezza H.</li>
            <li><b>Sp</b> — se usa lo spessore.</li>
            <li><b>Mat</b> — se il materiale va scelto.</li>
            <li><b>Fin</b> — se la finitura va scelta.</li>
            <li><b>Tok</b> — se serve il <i>Token</i> (es. DX/SN/altro, max 5 caratteri).</li>
          </ul>
        </li>
      </ol>
      <h3>Come salvare le liste</h3>
      <ul>
        <li><b>Salva</b> → memorizza tutto <u>solo in questo browser</u> (sul tuo PC). Se svuoti la cache o cambi PC, i dati non ci sono più.</li>
        <li><b>Esporta JSON</b> → scarica un file con tutte le liste (ottimo per backup o per passarlo a un collega).</li>
        <li><b>Importa JSON</b> → carica un file esportato in precedenza.</li>
        <li><b>Reset default</b> → ricarica i file standard del progetto (quelli nel repository), utile per ripartire da zero.</li>
        <li><b>Rimuovi override</b> → cancella le modifiche salvate nel browser.</li>
      </ul>
      <div class="callout warn"><b>Consiglio:</b> dopo aver “Salvato”, fai anche “Esporta JSON” e conservalo come copia di sicurezza.</div>

      <h3>Rendere i dati “default per tutti”</h3>
      <ol>
        <li>Recupera dal client dell’utente il file tramite <b>Esporta JSON</b>.</li>
        <li>Apri <b>Dati</b> → <b>Importa JSON</b> per verificare che tutto sia ok.</li>
        <li>Premi <b>Salva su GitHub (API)</b> (serve token con permesso “Contents: RW”) <b>oppure</b> usa <b>Apri editor GitHub</b> e incolla nei file in <code>assets/data/</code>.</li>
        <li>Comunica ai colleghi di cliccare il <b>badge arancione</b> (o “Rimuovi override”) per allinearsi ai nuovi default.</li>
      </ol>
    </section>

    <!-- Generatore -->
    <section class="card">
      <h2>Generare il codice (passo passo)</h2>
      <ol>
        <li>Apri la pagina <a href="index.html">Generatore</a>.</li>
        <li>Dal blocco <b>Cataloghi</b> scegli:
          <ul>
            <li><b>Famiglia</b> (es. ARG – Argani)</li>
            <li><b>Materiale</b> (es. S235 – Acciaio S235) — appare solo se la famiglia lo prevede.</li>
            <li><b>Finitura</b> (es. V – Verniciato) — appare solo se la famiglia lo prevede.</li>
          </ul>
        </li>
        <li>Nella riga <b>Composizione ShortCode</b> spunta i pezzi che vuoi inserire nel codice (quelli non spuntati valgono <code>000</code>).</li>
        <li>Nel blocco <b>Attributi</b> compila:
          <ul>
            <li><b>Tipo Prodotto</b> (es. TUB = Tubo, LAM = Lamiera…)</li>
            <li><b>Ø D</b>, <b>L</b>, <b>H</b>, <b>Spessore</b> — solo i campi abilitati dalla famiglia.</li>
            <li><b>Token</b> (max 5 caratteri, es. DX, SN, 4444) — solo se previsto.</li>
          </ul>
        </li>
        <li>Nell’area <b>Output</b> ottieni:
          <ul>
            <li><b>ShortCode (auto)</b> — il codice tecnico.</li>
            <li><b>Descrizione (auto)</b> — testo compatto: <i>Famiglia (testo) – TIPO (sigla) – Ø/L/H/Sp – Materiale (sigla) – Finitura (sigla) – Token (solo valore)</i>.</li>
            <li><b>Nome cartella (auto)</b> — codice + descrizione.</li>
          </ul>
          Usa i pulsanti <b>Copia</b> per incollare dove ti serve.
        </li>
      </ol>
    </section>

    <!-- Consigli -->
    <section class="card">
      <h2>Consigli rapidi</h2>
      <ul>
        <li>Usa <b>codici brevi</b> in MAIUSCOLO (niente spazi): es. <code>ARG</code>, <code>TUB</code>, <code>S235</code>, <code>V</code>.</li>
        <li>La <b>descrizione</b> dev’essere chiara: es. “Argani”, “Lamiera”, “Verniciato”.</li>
        <li>Se il codice mostra molti <code>000</code>, significa che non hai spuntato (o compilato) quei campi.</li>
        <li>Per lavorare con colleghi: usa <b>Esporta JSON</b> e <b>Importa JSON</b>.</li>
      </ul>
    </section>

    <!-- FAQ -->
    <section class="card">
      <h2>Domande frequenti (FAQ)</h2>

      <h3>1) Ho inserito i dati ma non li vedo nel Generatore.</h3>
      <p>Controlla di aver fatto <b>Salva</b> nella pagina <b>Dati</b>. Poi ricarica il Generatore.</p>

      <h3>2) Ho perso i dati inseriti.</h3>
      <p>I dati salvati con <b>Salva</b> restano nel <b>browser</b> del tuo PC. Se cambi PC, svuoti la cache o usi un altro browser, i dati non ci sono.  
      Soluzione: usa <b>Esporta JSON</b> per fare un backup, e <b>Importa JSON</b> per ripristinare.</p>

      <h3>3) Non vedo alcune misure (D / L / H / Sp).</h3>
      <p>Dipende dalla <b>Famiglia</b>. Nella pagina Dati, nella riga della famiglia, devi spuntare le caselle relative a quelle misure.</p>

      <h3>4) La descrizione non si compila.</h3>
      <p>La descrizione compare se hai scelto la <b>Famiglia</b> e, se spuntati, hai inserito i valori di D, L, H, Sp, Materiale, Finitura e Token.</p>

      <h3>5) Come faccio a far usare a tutti i nuovi default?</h3>
      <p>Dopo aver aggiornato i file in <code>assets/data/</code>, chiedi ai colleghi di cliccare il <b>badge arancione</b> (oppure “Rimuovi override” in Dati). Così vedranno subito i nuovi valori.</p>
    </section>
  </main>

  <!-- ===== FOOTER ===== -->
  <footer class="app-footer">
    <div class="footer-inner">
      <span class="product">&copy; Tecnical Coder</span>
      <span class="for"> per Grimaldelli s.r.l.</span>
      <span class="sep"> — </span>
      <span class="signature">Manuel Zago</span>
    </div>
  </footer>

  <!-- ===== SCRIPT ===== -->
  <script>
    /* ===== Tema chiaro/scuro ===== */
    const THEME_KEY='tc.theme';
    const setTheme = t => document.documentElement.setAttribute('data-theme', t);
    (function(){ setTheme(localStorage.getItem(THEME_KEY) || 'dark'); })();
    document.getElementById('themeToggle').addEventListener('click', ()=>{
      const curr = document.documentElement.getAttribute('data-theme')==='light'?'light':'dark';
      const next = curr==='light' ? 'dark' : 'light';
      setTheme(next); localStorage.setItem(THEME_KEY, next);
    });

    /* ===== Badge versione auto da GitHub + click per aggiornare ===== */
    function guessRepo(){
      const host = location.hostname;                 // es. gtr2500.github.io
      const owner = host.split('.')[0];               // gtr2500
      const path = location.pathname.split('/').filter(Boolean);
      const repo  = path[0] || 'CoderSmart';          // cartella progetto pages
      const branch = 'main';
      return { owner, repo, branch };
    }
    const OV_KEYS = [
      'scm.catalogs.override','scm:catalogsOverride',
      'scm_override_catalogs','ShortCodeMakerV4.catalogsOverride'
    ];
    function clearLocalOverrides(){ OV_KEYS.forEach(k=>localStorage.removeItem(k)); }
    async function clearHttpCaches(){
      if(!('caches' in window)) return;
      const keys = await caches.keys();
      await Promise.all(keys.map(k=>caches.delete(k)));
    }
    async function loadVersionBadge(){
      const badge = document.getElementById('buildBadge');
      if(!badge) return;
      badge.textContent = 'Verifica aggiornamenti…';
      try{
        const {owner, repo, branch} = guessRepo();
        const url = `https://api.github.com/repos/${owner}/${repo}/commits?sha=${branch}&per_page=1`;
        const resp = await fetch(url, {headers:{'Accept':'application/vnd.github+json'}});
        if(resp.ok){
          const arr = await resp.json();
          if(Array.isArray(arr) && arr.length){
            const sha = (arr[0].sha||'').slice(0,7);
            const iso = arr[0].commit?.committer?.date || arr[0].commit?.author?.date || new Date().toISOString();
            const d   = new Date(iso);
            const dataIT = d.toLocaleDateString('it-IT');
            const oraIT  = d.toLocaleTimeString('it-IT',{hour:'2-digit',minute:'2-digit'});
            const version = `${d.getFullYear()}${String(d.getMonth()+1).padStart(2,'0')}${String(d.getDate()).padStart(2,'0')}-${sha}`;
            badge.textContent = `Ultimo agg.: ${dataIT} ${oraIT} • ${sha}`;
            badge.dataset.version = version;
            badge.addEventListener('click', async ()=>{
              const ok = confirm('Aggiornare alla versione più recente?\nQuesto cancellerà i dati salvati in locale (override) e pulirà la cache.\nProcedere?');
              if(!ok) return;
              try{ clearLocalOverrides(); await clearHttpCaches(); }catch(e){}
              const v = badge.dataset.version || Date.now();
              const base = location.pathname.split('?')[0];
              const qs = location.search && !location.search.includes('v=') ? location.search + '&' : '?';
              location.replace(base + qs + 'v=' + v);
            });
            return;
          }
        }
      }catch(e){}
      // fallback
      badge.textContent = 'Ultimo agg.: ' + new Date(document.lastModified).toLocaleString('it-IT');
    }
    loadVersionBadge();
  </script>
</body>
</html>
